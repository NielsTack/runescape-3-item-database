<?php
    $itemsInfoHTML = file_get_contents('iteminfo.json');
    $itemsInfo = json_decode($itemsInfoHTML, true);
    $knownoverlap = array(49404, 12454, 12427, 45321, 45328, 45335, 45342, 12035, 20416, 12457, 25927, 44979, 12465, 11834, 11836, 44640, 44642, 44644, 44646, 45051, 44947, 45507, 12920, 4798, 45030, 45027, 44963, 45517, 45509, 9463, 44850, 44847, 45495, 41928, 2539, 44987, 45061, 3200, 11375, 2603, 45043, 867, 45519, 44911, 9429, 44914, 45503, 44866, 44863, 45497, 44998, 44995, 45513, 12081, 44955, 44958, 45508, 44974, 44971, 44855, 45510, 44858, 45496, 44919, 44871, 44874, 44903, 44887, 44890, 44939, 45019, 2609, 45003, 45515, 44898, 1245, 45038, 44879, 44882, 44929, 37929, 23411, 11463, 4872, 4866, 4436, 44546, 5767, 44906, 10366, 39361, 19372, 11061, 19378, 20129, 19396, 37052, 177, 2456, 45514, 11503, 45011, 6910, 5954, 11435, 5992, 5943, 3749, 47950, 5947, 10808, 12913, 45499, 19392, 5785, 5779, 5861, 5865, 5996, 3402, 11461, 3036, 5819, 5825, 5905, 5751, 6961, 4712, 11238,5903, 19376, 19364, 45143, 45504, 39822, 45138, 29864, 45165, 45300, 45284, 45180, 45076, 45310, 45091, 45117, 45102, 45160, 45081, 45232, 45211, 45222, 45243, 44682, 45158, 44678, 44686, 11846, 45263, 32368, 37417, 12885, 1919, 6908, 12878, 11128, 1367, 49402, 3098, 11507, 2635, 11433, 1217, 5958, 4821, 1426, 2597, 2585, 48241, 47506, 41206, 10085, 45498, 19453, 41227, 10386, 10388, 19465, 19362, 44922, 19459, 19445, 20000, 45502, 12061, 10384, 19443, 23050, 7325, 2499, 25796, 7376, 2505, 44936, 7384, 23048, 1905, 650, 640, 5863, 18691, 660, 10081, 5018, 8014, 21365, 20452, 19449, 2934, 2021, 1921, 8015, 5753, 5901, 45963, 45352, 45359, 45387, 45324, 12461, 45973, 46046, 1375, 45500, 46051, 46061, 45035, 11367, 9174, 12073, 25692, 804, 6235, 25710, 12087, 44932, 6237, 12, 25865, 10, 25859, 41198, 8556, 11083,10981, 19331, 44895, 2259, 48990, 48986, 5913, 5829, 5833, 5907, 6794, 5909, 7086, 47399, 2601, 5927, 8518, 5763, 9640, 9642, 5923, 19366, 7451, 5757, 11118, 12969, 11126, 9743, 12983, 12976, 45984, 6474, 6472, 47970, 13944, 13908, 13929, 12091, 13923, 48992, 13935, 2343, 13958, 13926, 13985, 13932, 13988, 48590, 40766, 20440, 13967, 13947, 40338, 20320, 14842, 20436, 20272, 35404, 32219, 32240, 32272, 10820, 20070, 36808, 4460, 4860, 2503, 2641, 20454, 26347, 36811, 10127, 11459, 38467, 6388, 10061, 39573, 4722, 9243, 4884, 35585, 44049, 50857, 4718, 13740, 37012, 44047, 4902, 43442, 25316, 42382, 45349, 45356, 45370, 5803, 1089, 35408, 7158, 536, 11842, 5889, 5745, 11256, 11222, 19455, 13006, 1305, 12608, 14531, 25478, 3349, 1249, 11284, 19358, 5885, 1664, 1702, 12906, 10354, 12043, 31373, 5773, 5777, 5853, 41674, 5851, 575, 11115, 44942, 7056, 45616,5781, 1399, 44690, 44688, 45794, 11264, 12892, 45675, 45665, 44692, 45564, 45585, 45559, 45648, 45650, 45595, 45518, 45737, 45686, 45758, 45701, 45691, 29734, 2297, 18699, 20458, 20127, 8872, 45014, 45644, 41654, 9241, 8017, 43169, 8016, 7399, 11076, 8018, 45986, 1677, 12051, 34139, 12830, 11246, 3373, 1025, 33516, 39358, 3755, 7934, 37034, 11477, 2438, 153, 14850, 14846, 2460, 3404, 20386, 598, 10826, 38469, 7082, 40814, 40854, 2277, 10958, 20278, 23471, 3793, 5345, 12033, 7441, 8588, 9846, 9857, 8574, 26292, 11505, 8608, 25007, 12835, 19374, 11069, 11714, 10047, 11710, 528, 3122, 628, 1135, 10564, 10589, 45305, 5789, 1151, 45170, 5873, 10079, 5871, 5791, 45295, 1044, 45096, 638, 1397, 34828, 45107, 4920, 5003, 4926, 23555, 10442, 6760, 29454, 29450, 20035, 23179, 7180, 7210, 7200, 2299, 2295, 2333, 5994, 50855, 7062, 2209, 15241,39355, 10004, 2458, 33628, 5847, 12531, 50561, 1599, 25662, 45988, 11262, 1997, 6918, 19368, 23125, 12841, 6924, 5575, 44065, 45501, 12462, 25921, 45890, 1203, 1191, 5945, 12075, 2533, 44626, 23447, 25676, 45846, 45862, 19370, 45918, 12822, 45866, 45858, 1175, 23579, 39332, 23143, 20013, 23137, 20021, 20007, 20006, 20004, 5386, 47966, 10057, 23149, 20016, 20017, 23131, 5859, 1881, 40312, 10111, 13961, 32372, 10035, 15517, 13746, 8580, 7447, 3053, 12788, 2607, 10037, 5545, 3371, 10045, 18693, 13355, 37445, 12207, 652, 9052, 26283, 12071, 12437, 27500, 27518, 27516, 12041, 8788, 45112, 9864, 8606, 9851, 6418, 10143, 9847, 5821, 3444, 5823, 7449, 5765, 6420, 6402, 5795, 36063, 5801, 5879, 20450, 20460, 5799, 5529, 6396, 9848, 9731, 11832, 44634, 12464, 46272, 46184, 9450, 46195, 45482, 9181, 44636, 46251, 46097, 46216,3198, 9418, 2593, 45476, 46114, 46268, 31737, 45470, 45483, 46107, 46188, 45471, 46132, 45473, 45477, 46244, 46233, 46223, 46288, 1700, 46261, 45491, 46128, 46118, 1243, 10909, 10921, 46149, 45478, 5811, 5813, 46153, 10915, 46167, 44045, 12804, 13883, 1401, 25812, 39382, 5893, 11212, 45148, 46361, 1403, 46487, 44670, 44676, 45363, 45274, 46398, 46518, 5541, 46309, 1377, 46346, 46481, 46330, 46299, 46320, 1015, 11732, 46351, 46461, 46372, 11254, 46424, 550, 46445, 6410, 1215, 3204, 8590, 8578, 24365, 12792, 8600, 5956, 25312, 4168, 25785, 25939, 12204, 25698, 35116, 8, 25899, 25907, 25948, 12565, 25740, 25564, 12563, 4522, 4537, 12899, 9194, 11130, 41679, 39330, 41634, 6577, 39324, 8560, 7327, 39322, 45154, 2112, 10146, 46574, 46571, 6313, 46643, 46597, 46591, 6701, 2470, 46584, 46558, 46656, 46594, 46623, 46545, 46539, 46617, 29556, 5416, 46578, 46639, 50553, 47982, 41649, 46610, 7166, 7204, 413, 32809, 32813, 32907, 32785, 32789, 44680, 32803, 32787, 32763, 45248, 32771, 19325, 32795, 32769, 32755, 45549, 45253, 50556, 5949, 1789, 3398, 28677, 28679, 28673, 45722,626, 1013, 32797, 636, 7114, 42380, 32895, 13366, 7134, 7162, 7128, 7124, 13368, 1863, 2283, 13370, 40862, 28669, 20284, 40782, 7112, 31313, 11854, 29245, 29241, 31317, 23062, 2583, 6705, 12871, 12011, 2028, 2241, 2231, 2227, 2239, 9670, 2225, 11465, 9672, 1391, 2468, 12816, 15119, 7196, 7186, 2202, 2337, 42249, 7216, 3751, 11868, 10138, 5783, 30028, 41628, 12442, 12840, 4848, 11439, 4846, 14622, 45391, 45377, 2926, 15511, 41847, 4842, 4840, 24382, 24342, 30412, 4878, 25553, 11085, 15503, 24379, 6963, 44650, 44656, 12423, 19457, 892, 46892, 46792, 4803, 46809, 44658, 45258, 19422, 44684, 24346, 1107, 45534, 179, 10376, 46839, 2540, 44648, 2619, 11377, 11656, 10290, 2675, 3486, 2665, 32228, 46689, 45540, 12083, 46852, 45535, 46749, 46752, 45537, 46682, 46799, 46762, 46702, 46742, 45531,46782, 45529, 46722, 45525, 45533, 46759, 2661, 2653, 19200, 45527, 3481, 46882, 25800, 2663, 46945, 19431, 19266, 46859, 2617, 19416, 19242, 3480, 19185, 19182, 45542, 46732, 45528, 3485, 19203, 12451, 46899, 7342, 19269, 46769, 7354, 19419, 805, 7323, 46905, 45532, 46712, 46872, 21364, 2589, 41639, 10927, 10925, 6691, 5793, 10931, 25034, 23167, 20032, 20029, 20027, 26339, 23173, 41881, 41863, 41883, 41869, 28621, 31322, 29269, 41871, 38464, 5032, 2080, 993, 12836, 5915, 7230, 20001, 9984, 5839, 5050, 3379, 5921, 20037, 15123, 3162, 10472, 2213, 7072, 47962, 25841, 6330, 41204, 6299, 50859, 12095, 12017, 12063, 12778, 12097, 50863, 12456, 12099, 6131, 13734, 12181, 25804, 41575, 13884, 11824, 44630, 45453, 47009, 45455, 45279, 3353, 3194, 12806, 46989, 47005, 46981, 47063, 19461, 47033, 46965, 45445, 46993, 46973, 25855,12045, 47045, 3093, 41217, 23207, 11441, 19463, 3357, 40870, 45366, 10372, 50843, 50847, 28213, 28203, 28199, 11820, 10374, 10390, 28211, 25810, 28197, 44075, 185, 49004, 44099, 44071, 183, 11499, 11471, 11515, 44089, 3196, 15329, 15331, 44083, 12444, 11509, 23279, 32090, 11487, 45878, 9741, 10978, 565, 2187, 45886, 8602, 8582, 12776, 4339, 4345, 3329, 4337, 4353, 4361, 4333, 4367, 4315, 4385, 4359, 4371, 4391, 4393, 4381, 41625, 6912, 4405, 4411, 41989, 4325, 4329, 2591, 19284, 4327, 4349, 20009, 3369, 7374, 19311, 33298, 19314, 23155, 19317, 12824, 6525, 13101, 2255, 20005, 50462, 1757, 4974, 20026, 6962, 39342, 6371, 4956, 654, 45128, 634, 6527, 2001, 9629, 664, 6528, 4968, 5038, 4825, 13563, 2281, 12447, 4986, 12053, 13893, 6375, 5478, 10041, 4753, 38466, 12780, 12826, 13899, 39574, 12443, 20462, 11501, 25513, 25517, 25525, 25509, 25529, 5533, 25543, 25539, 50555, 2017,1023, 6589, 6587, 6609, 6633, 6599, 6625, 1048, 6611, 6605, 6613, 6412, 3442, 6623, 7394, 19329, 8576, 10053, 1171, 3345, 2253, 3351, 2191, 2341, 5998, 11240, 10444, 11521, 11074, 3446, 20671, 11455, 13864, 11065, 20040, 9452, 12450, 6416, 5543, 10380, 5899, 5739, 6047, 25831, 9448, 45968, 9858, 8786, 12583, 45978, 12448, 45196, 28661, 5741, 45331, 40987, 45133, 6392, 6406, 19451, 12568, 18697, 45191, 12216, 5797, 10368, 5875, 5755, 45394, 13736, 9733, 869, 46041, 600, 25925, 46209, 47958, 44632, 12424, 44638, 36274, 23195, 11816, 46181, 11479, 45480, 155, 4793, 11457, 3339, 46198, 135, 9461, 46100, 39367, 45175, 14852, 46281, 14848, 9416, 2865, 11373, 10063, 46265, 2428, 866, 12782, 630, 9427, 46156, 20356, 46111, 40774, 49548, 20326, 12079, 45486, 40894, 35583, 45481, 46205, 9644, 46104, 3190, 3797, 45469, 46163, 46121, 46146, 45475, 10954, 45086, 46174, 7382, 9420, 11828, 11848,46230, 46237, 22466, 22458, 19333, 7668, 45472, 46125, 803, 25933, 10913, 10911, 10917, 33294, 25743, 44051, 50552, 5815, 5817, 5891, 50460, 5895, 13748, 5897, 41946, 13879, 13876, 1042, 7066, 12429, 19327, 1785, 22454, 3327, 19394, 1405, 4095, 3054, 6563, 45227, 11690, 11712, 11250, 8784, 46356, 45217, 44672, 44674, 44668, 46492, 10051, 46497, 46507, 46502, 45206, 46304, 46294, 5809, 46393, 12833, 46403, 46383, 46523, 46528, 9434, 46466, 46471, 7521, 9244, 46335, 46374, 4153, 46376, 46440, 46450, 46414, 46435, 5016, 46409, 10370, 48996, 6408, 31377, 11864, 35115, 13953, 3440, 25314, 8598, 19447, 13920, 1434, 13914, 5787, 47974, 13911, 19350, 25900, 5867, 13917, 25767, 4087, 25863, 25912, 25680, 25881, 13941, 13973, 25814, 25776, 2307, 19323, 31376, 38468, 29543, 29544, 29537, 11037, 25562, 25883, 13964, 45958, 33901, 25908, 25885, 25898, 1645, 2864, 13113, 12570, 1615,45338, 34830, 34832, 12559, 3335, 3428, 3426, 20350, 4908, 45156, 40806, 9245, 45380, 7666, 9342, 40886, 20456, 20296, 5771, 39326, 46056, 5855, 29458, 19830, 632, 29452, 662, 48988, 44664, 44662, 44660, 
    46649, 44666, 46646, 20036, 12430, 5535, 46659, 46662, 12837, 46633, 46636, 13081, 46630, 46555, 5827, 46561, 46581, 7190, 46587, 5831, 46620, 46607, 46613, 29635, 2335, 46542, 3095, 46548, 45626, 2303, 411, 5911, 12093, 407, 15243, 38463, 7174, 1953, 7214, 41626, 32665, 45799, 13109, 1341, 44844, 32210, 32943, 32811, 45670, 39379, 2185, 32761, 32871, 45815, 45820, 32805, 45554, 32919, 45569, 1869, 32779, 32753, 5843, 10156, 5845, 11517, 12025, 5849, 45580, 31865, 14623, 45642, 28667, 28671, 45727, 18695, 28675, 12829, 28659, 2048, 4103, 39579, 656, 646, 7130, 7136, 10378, 20410, 45763, 2285, 7132, 13364, 7126, 6922, 45122, 13358, 13360, 11874, 13362, 6916, 2651, 9668, 20362, 5574, 23122, 40822, 11852, 20448, 43466,12467, 23231, 12828, 14490, 10382, 31315, 44624, 29243, 29247, 29249, 43172, 1787, 27168, 5438, 45898, 27161, 50345, 45842, 11467, 45910, 6390, 6041, 2030, 2032, 3192, 2223, 2229, 45938, 9423, 2221, 8021, 12049, 2235, 45850, 7400, 2233, 7398, 45914, 11447, 9676, 11445, 9666, 9678, 1959, 9739, 45854, 25727, 3438, 45870, 25712, 15121, 19998, 6476, 27520, 27510, 27496, 27508, 4832, 12820, 1239, 45934, 1279, 5001, 45882, 39340, 7568, 12453, 7176, 39334, 6315, 7566, 30076, 7168, 3381, 31335, 20010, 8880, 48998, 1940, 20022, 1393, 4287, 2476, 14665, 12802, 7319, 2501, 19967, 25798, 36380, 13957, 23267, 20015, 10059, 12023, 1038, 10083, 4732, 41659, 4938, 11133, 4950, 13938, 4944, 4844, 23537, 11437, 29540, 131, 5805, 5807, 45384, 38465, 45398, 40655, 5883, 2572, 13982, 2566, 5887, 13970, 1911, 3400, 13979, 10039, 2898, 41845, 3105, 20444, 26286, 6130, 6128, 20464, 8584, 7445, 3775, 10043, 3795, 24340, 5539, 10956, 19346, 15505, 11332, 15507, 24344, 1698, 1149, 22462, 47411, 46829, 3853, 11840, 31375, 44654, 46919, 46922, 46789, 46795, 12934, 13099, 46889, 12786, 38470, 46812, 45536, 46669, 19348, 46815, 642, 4585, 19407, 4587, 19437, 41948, 2673, 2657, 8594, 2627, 46842, 8622, 46935, 3202, 10286, 10292, 10294, 19425, 19410, 12449, 2667, 11491, 2932, 25559, 11489, 46915, 2629, 46912, 45546, 9431, 46755, 45530, 5925, 32243, 46695, 46849, 46855, 5929, 46802, 46805, 35400, 46819, 46825, 46679, 11252, 45523, 540, 9861, 46765, 32216, 8572, 9845, 46705, 46739, 9867, 46745, 9856, 46719, 46725, 6213, 46779, 46785, 10049, 32237, 46942, 19398, 19413, 19428, 2669, 2615, 11200, 19179, 19221, 19263, 2623, 46879, 5775, 19401, 3483, 2671, 6809, 2655, 12069, 14679, 19245, 19224, 5857, 2625, 46862, 19404, 19434, 3479, 3478, 3476, 11244, 19206, 19227, 19248, 3477, 46869, 46875, 46729,46735, 7336, 7348, 11248, 7360, 10115, 12927, 46902, 45545, 46709, 7064, 46715, 45526, 46772, 46775, 38823, 43454, 25794, 47554, 44057, 9465, 3436, 3434, 12831, 45631, 20002, 5877, 658, 6, 45611, 5881, 648, 12446, 10929, 44694, 23567, 1050, 44696, 39376, 11072, 5014, 5547, 45784, 45789, 5869, 6689, 10440, 11830, 45660, 25666, 10470, 20034, 20033, 20031, 20030, 45825, 47954, 26298, 26304, 42238, 44416, 44426, 45468, 26338, 41861, 45590, 41865, 27159, 41877, 41879, 41873, 45600, 41875, 41867, 9003, 45646, 33296, 45492, 8596, 2368, 4724, 45732, 4914, 5044, 2976, 45717, 46191, 7664, 29271, 45696, 29273, 46202, 45706, 4716, 9436, 46160, 31332, 45753, 45768, 7443, 9992, 46135, 45748, 7224, 11113, 45479, 5917, 5919, 29736, 5835, 5837, 29456, 5841, 5761, 4170, 46139, 20038, 45474, 9729, 46170, 49413, 10923, 50554, 7439, 13752, 7220, 9996, 39891, 9994, 1989, 25843, 25839, 25837, 34978, 2955, 49410, 10077, 12455, 11944, 13870,50865, 50861, 12105, 37009, 12810, 12027, 12784, 22456, 12103, 12059, 8019, 12808, 12107, 11286, 8020, 1407, 12101, 10812, 2900, 3387, 3385, 25670, 25640, 6965, 23375, 11453, 561, 13896, 13754, 13890, 12065, 25923, 12463, 23435, 44628, 47053, 10002, 47001, 12827, 9459, 46953, 46314, 2535, 46388, 827, 9425, 46985, 46961, 12134, 47025, 46476, 12077, 12834, 45454, 47013, 46325, 45456, 46957, 45442, 25642, 45450, 45444, 45448, 45446, 46997, 45452, 11844, 8604, 46977, 45447, 1241, 46419, 46429, 46969, 45451, 48712, 28628, 50557, 47405, 10364, 6382, 5576, 40910, 20290, 9004, 11088, 25877, 34929, 50849, 50845, 45906, 28209, 3331, 28195, 151, 28205, 28201, 28215, 11475, 11473, 23255, 11469, 49006, 11497, 44073, 3020, 11483, 25916, 11481, 44097, 25689, 44091, 11103, 29534, 4608, 11513, 15330, 15328, 23525, 11511, 1293, 45874, 1420, 11495, 11493, 3783, 44081, 44077, 43490, 45894, 45902, 4850, 12438, 25935, 12561);


    $items = [];

    foreach ($itemsInfo as $iteminfo) {
     
        $id = $iteminfo["id"];
        echo "current item info: ".json_encode($iteminfo)."<br>";

        if(!in_array($id, $knownoverlap)) {
            try {
                $start = microtime(true);
                $itemGraphHTML = file_get_contents('https://secure.runescape.com/m=itemdb_rs/api/graph/'.$id.'.json');
                $itemGraph = json_decode($itemGraphHTML, true);
                $max = 0;
                $min = 99999999;
                $todaysPrice = $itemGraph['daily'][array_key_last($itemGraph['daily'])];
                $time_elapsed_secs = microtime(true) - $start;
                if($time_elapsed_secs < 5){
                    sleep(5-$time_elapsed_secs);
                }
                foreach ($itemGraph['daily'] as $date => $price) {
                    $max = ($price > $max) ? $price : $max;
                    $min = ($price < $min) ? $price : $min;
                }
                echo "max:".$max." min:".$min." todays price:".$todaysPrice."<br>";
                if(($max*.9 > $min*1.1) && $todaysPrice*$iteminfo["buylimit"] > 2000000){
                    $items[$id] = $iteminfo;
                    echo "pushed item<br><br>";
                } else{
                    echo "did not push item<br><br>";
                }
            } catch (Exception $e) {

            }
        } else {
            echo 'item already in overlap <br><br>';
        }
    }

    sort($items);
    // encode items array to json
    $json = json_encode($items, JSON_UNESCAPED_SLASHES | JSON_NUMERIC_CHECK);

    //write json to file
    if (file_put_contents("iteminfo_filtered.json", $json)) {
        echo nl2br("JSON file created successfully...\n");
    } else {
        echo nl2br("Oops! Error creating json file...\n");
    }

    // in case writing to file didnt work for some reason, echo items so you dont have to start over
    echo $json;

?>